@model NeuralPlay.Models.PerfilViewModel
@using System.Security.Claims
@inject NeuralPlay.Services.IUsuarioAuth UsuarioAuth

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = $"Perfil de {Model.NickUsuario}";
    var currentUser = UsuarioAuth.GetUsuarioActual();
    ViewBag.OcultarNavbar = true;
}

@Html.Partial("~/Views/Shared/_SidebarLeft.cshtml")
@Html.Partial("~/Views/Shared/_SidebarRight.cshtml")
@Html.Partial("~/Views/Shared/_SidebarDown.cshtml")

<style>
    :root {
        --np-red: #e50a46;
        --np-transp: #21020a7a;
        --np-grey: #454545;
        --np-dark-grey: #242424;
    }

    @@font-face {
        font-family: 'Neue';
        src: url('/Recursos/NeuePower-Ultra.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }

    @@font-face {
        font-family: 'Lexend';
        src: url('/Recursos/Lexend-Medium.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }

    body {
        background: url('/Recursos/WALLPAPER_GRIS.png') no-repeat center center fixed;
        background-size: cover;
    }

    .profile-header {
        text-align: center;
        margin-bottom: 15px;
        padding-top: 10px;
    }

    .profile-header h1 {
        font-family: 'Neue', sans-serif;
        text-align: center;
        font-size: 3.5rem;
        color: white;
        margin-bottom: 10px;
        margin-right: 11vw;
    }

    .profile-header h1 .username {
        color: var(--np-red);
    }

    .profile-divider {
        width: 70%;
        height: 3px;
        background-color: white;
        margin: 0 auto 30px auto;
        margin-left: 6vw;
        margin-right: 11vw;
    }

    .profile-section-title {
        font-family: 'Neue', sans-serif;
        font-size: 5.5rem;
        color: white;
        margin-bottom: 30px;
        text-align: left;
        padding-left: 0;
        margin-left: 32px; /* Un poco más a la derecha */
        font-weight: bold;
    }

    .profile-card {
        background: var(--np-dark-grey);
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }

    .profile-card h3 {
        font-family: 'Neue', sans-serif;
        color: var(--np-red);
        margin-bottom: 20px;
        font-size: 2.2rem;
    }

    .profile-info dt {
        font-family: 'Neue', sans-serif;
        color: white;
        margin-bottom: 5px;
        font-size: 1.4rem;
    }

    .profile-info dd {
        font-family: 'Lexend', sans-serif;
        color: white;
        margin-bottom: 22px;
        font-size: 1.3rem;
    }

    .avatar-container {
        position: relative;
        min-height: 250px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .avatar-container:hover {
        transform: scale(1.02);
    }

    .avatar-container::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 100%;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.7) 30%, rgba(0, 0, 0, 0.3) 60%, transparent 100%);
        z-index: 1;
        pointer-events: none;
    }

    .avatar-container img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 0;
    }

    .avatar-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--np-grey);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 0;
    }

    .avatar-title {
        position: absolute;
        top: 30px;
        left: 50%;
        text-align: center;
        transform: translateX(-50%);
        font-family: 'Neue', sans-serif;
        color: white;
        font-size: 3.5rem;
        z-index: 2;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        pointer-events: none;
        letter-spacing: 2px;
        font-weight: bold;
        white-space: nowrap;
        width: max-content;
    }

    .avatar-no-edit {
        cursor: default;
    }

    .avatar-no-edit:hover {
        transform: none;
    }

    .btn-custom {
        background: linear-gradient(90deg, var(--np-red) 60%, #ff4b7d 100%);
        color: white;
        border: none;
        padding: 14px 36px;
        font-family: 'Neue', sans-serif;
        font-size: 1.2rem;
        border-radius: 8px;
        text-decoration: none;
        display: inline-block;
        box-shadow: 0 2px 8px rgba(229,10,70,0.15);
        transition: transform 0.2s, box-shadow 0.2s;
        font-weight: bold;
        letter-spacing: 1px;
    }

    .btn-custom:hover {
        transform: scale(1.07);
        box-shadow: 0 4px 16px rgba(229,10,70,0.25);
        color: #fff;
        text-shadow: 0 1px 8px #e50a46;
    }

    .feed-container {
        text-align: center;
        padding: 40px;
    }

    .content-wrapper {
        margin-right: 6vw;
        padding: 0 20px 60px 20px;
    }

    .game-item {
        font-family: 'Lexend', sans-serif;
        margin-bottom: 10px;
        color: white;
    }

    .no-games-text {
        font-family: 'Lexend', sans-serif;
        color: var(--np-grey);
    }

    .profile-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
        margin-bottom: 40px;
        grid-column: 1 / -1;
        width: 100%;
    }

    .profile-actions a,
    .profile-actions button {
        flex: 0 1 200px;
        padding: 15px 20px;
        text-align: center;
        border: none;
        border-radius: 8px;
        font-family: 'Neue', sans-serif;
        font-weight: bold;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s, box-shadow 0.2s;
        white-space: nowrap;
        min-height: 50px;
    }

    .profile-actions a:hover,
    .profile-actions button:hover {
        transform: scale(1.05);
    }

    /* Ajustes para Tablet */
    @@media (min-width: 581px) and (max-width: 1024px) {
        .content-wrapper {
            padding-bottom: 60px; /* Espacio para evitar superposición con footer */
        }

        .profile-actions {
            margin-bottom: 40px; /* Margen extra inferior para los botones */
        }

        /* Alineación y separación de botones de acción */
        .profile-card nav {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .profile-card nav .btn-custom {
            margin: 0 !important; /* Resetear márgenes inline */
            width: 100%;
            text-align: center;
            display: block;
        }

        /* Aumentar espacio entre dt y dd forzando anchos */
        .profile-info dt.col-sm-4 {
            width: 100%; /* En tablet poner etiqueta arriba */
            margin-bottom: 5px;
        }
        
        .profile-info dd.col-sm-8 {
            width: 100%; /* En tablet poner valor abajo */
            margin-bottom: 20px;
            padding-left: 15px; /* Indentación ligera */
        }
    }

    /* Ajustes para Móvil */
    @@media (max-width: 580px) {
        .content-wrapper {
            margin-right: 0;
            padding: 0 15px;
        }

        .profile-header h1 {
            font-size: 3rem;
            margin-right: 0;
        }
        
        .profile-header h1 .username {
            font-size: inherit;
            display: inline;
            margin-top: 0;
        }

        .profile-section-title {
            font-size: 3rem;
            margin-left: 0;
            text-align: left;
            padding-left: 15px;
        }

        .profile-divider {
            margin-left: auto;
            margin-right: auto;
            width: 85%;
        }

        /* Separación entre tarjetas apiladas */
        .col-md-6 {
            margin-bottom: 20px; /* Reducido de 30px */
        }

        /* Aumentar tamaño de letra lista de juegos */
        .game-item {
            font-size: 1.3rem;
        }

        /* Ajuste botones acciones finales */
        .profile-actions {
            flex-direction: column;
            gap: 15px;
            margin-bottom: 100px; /* Espacio para footer */
            margin-top: 10px; /* Reducir margen superior */
        }
        
        .profile-actions a,
        .profile-actions form,
        .profile-actions button {
            width: 100% !important;
            flex: 0 0 auto !important;
            margin: 0;
        }

        .profile-actions a,
        .profile-actions button {
            padding: 16px !important; /* Aumentado de 10px para hacerlos más altos */
            min-height: 0 !important;
            height: auto !important;
            line-height: normal;
        }

        /* Botones en la sección de información (Añadir Juego, Editar Perfil) */
        .profile-card nav {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .profile-card nav .btn-custom {
            width: 90% !important;
            margin: 0 !important;
            text-align: center;
            display: block;
        }

        /* Reducir tamaño del texto "FOTO DE PERFIL" */
        .avatar-title {
            font-size: 2rem;
            letter-spacing: 1px;
        }
    }
</style>

<header class="profile-header">
    @if (currentUser?.IdUsuario == Model.IdUsuario)
    {
        <h1>Bienvenido, <span class="username">@Model.NickUsuario</span></h1>
        <div class="profile-divider"></div>
        <h2 class="profile-section-title">Tu Perfil</h2>
    }
    else
    {
        <h2 class="profile-section-title">Perfil de <span style="color: var(--np-red);">@Model.NickUsuario</span></h2>
    }
</header>

<main class="content-wrapper">
    <section class="container-fluid">
        <div class="row">
            <!-- Columna izquierda: Datos del usuario y juegos -->
            <section class="col-md-6">
                <article class="profile-card" style="height: 100%;">
                    <h3>Información del Perfil</h3>
                    <dl class="profile-info row">
                           <dt class="col-sm-4">Nickname</dt>
                           <dd class="col-sm-8">@Html.DisplayFor(model => model.NickUsuario)</dd>
                           <dt class="col-sm-4">Descripción</dt>
                           <dd class="col-sm-8">@Html.DisplayFor(model => model.Descripcion)</dd>
                    </dl>
                    <h3 style="margin-top: 10px;">Juegos</h3>
                    @if (Model.Juegos != null && Model.Juegos.Any())
                    {
                        <ul class="list-unstyled">
                            @foreach (var juego in Model.Juegos)
                            {
                                <li class="game-item">
                                    <strong>@juego.NombreJuego</strong> - @juego.Genero
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="no-games-text">Este perfil no tiene juegos añadidos.</p>
                    }
                    @if (currentUser != null && currentUser.IdUsuario == Model.IdUsuario)
                    {
                        <nav style="margin-top: 20px;">
                            <a asp-action="AnadirJuego" asp-route-idPerfil="@Model.IdPerfil" class="btn-custom">Añadir Juego</a>
                            <a asp-action="Edit" asp-route-id="@Model.IdPerfil" class="btn-custom" style="margin-left: 10px;">Editar Perfil</a>
                        </nav>
                    }
                </article>
            </section>
            <!-- Columna derecha: Foto de perfil y botón Feed -->
            <aside class="col-md-6">
                @if (currentUser != null && currentUser.IdUsuario == Model.IdUsuario)
                {
                    <a asp-action="Edit" asp-route-id="@Model.IdPerfil" style="text-decoration: none; color: inherit;">
                        <article class="profile-card avatar-container">
                            <span class="avatar-title">FOTO DE PERFIL</span>
                            @if (!string.IsNullOrEmpty(Model.Avatar))
                            {
                                <img src="@Model.Avatar" alt="Avatar" />
                            }
                            else
                            {
                                <div class="avatar-placeholder">
                                    <span style="font-family: 'Lexend', sans-serif; color: white; font-size: 1.5rem;">Sin foto</span>
                                </div>
                            }
                        </article>
                    </a>
                }
                else
                {
                    <article class="profile-card avatar-container avatar-no-edit">
                        <span class="avatar-title">FOTO DE PERFIL</span>
                        @if (!string.IsNullOrEmpty(Model.Avatar))
                        {
                            <img src="@Model.Avatar" alt="Avatar" />
                        }
                        else
                        {
                            <div class="avatar-placeholder">
                                <span style="font-family: 'Lexend', sans-serif; color: white; font-size: 1.5rem;">Sin foto</span>
                            </div>
                        }
                    </article>
                }
                <nav style="margin-top: 50px;">
                    <a asp-action="Feed" asp-route-id="@Model.IdPerfil" class="btn-custom" style="font-size: 2.5rem; padding: 32px 20px; width: 100%; display: block; text-align: center; box-sizing: border-box;">Ver Feed Personal</a>
                </nav>
            </aside>
        </div>
        
        @if (currentUser != null && currentUser.IdUsuario == Model.IdUsuario)
        {
            <div class="row" style="margin-top: 40px;">
                <div class="col-12">
                    <div class="profile-actions">
                        <a href="@Url.Action("Logout", "Usuario")" class="btn-custom" style="background-color: #454545; color: white; flex: 0 1 180px;">
                            Cerrar Sesión
                        </a>
                        <form method="post" action="@Url.Action("Delete", "Usuario")" style="flex: 0 1 180px; margin: 0;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@currentUser.IdUsuario" />
                            <button type="submit" class="btn-custom" style="width: 100%; background-color: #d32f2f; color: white; flex: 0 1 180px;">
                                Eliminar Cuenta
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        }
    </section>
</main>