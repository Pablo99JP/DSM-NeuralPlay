@model NeuralPlay.Models.TorneoDetailsViewModel
@inject NeuralPlay.Services.IUsuarioAuth UsuarioAuth

@{
    var currentUser = UsuarioAuth.GetUsuarioActual();
    var esCreador = currentUser != null && Model.Torneo.Creador != null && Model.Torneo.Creador.IdUsuario == currentUser.IdUsuario;
}

<h2>Detalles del Torneo</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<div class="card mb-3">
    <div class="card-body">
        <h3 class="card-title">@Model.Torneo.Nombre</h3>
        <p class="card-text"><strong>Fecha inicio:</strong> @(Model.Torneo.FechaInicio == default ? "-" : Model.Torneo.FechaInicio.ToString("yyyy-MM-dd"))</p>
        <p class="card-text"><strong>Estado:</strong> @Model.Torneo.Estado</p>
        @if (!string.IsNullOrWhiteSpace(Model.Torneo.Reglas))
        {
            <p class="card-text"><strong>Reglas:</strong> @Model.Torneo.Reglas</p>
        }
        @if (Model.Torneo.ComunidadOrganizadora != null)
        {
            <p class="card-text"><strong>Comunidad organizadora:</strong> @Model.Torneo.ComunidadOrganizadora.Nombre</p>
        }
        <div class="mt-3">
            <a class="btn btn-secondary" asp-action="Index">Volver</a>
            <a class="btn btn-primary" asp-action="ProponerParticipacion" asp-route-id="@Model.Torneo.IdTorneo">Proponer participación</a>
            @if (esCreador)
            {
                <a class="btn btn-warning" asp-action="Edit" asp-route-id="@Model.Torneo.IdTorneo">Editar</a>
                <a class="btn btn-danger" asp-action="Delete" asp-route-id="@Model.Torneo.IdTorneo">Eliminar</a>
            }
        </div>
    </div>
</div>

<h4>Propuestas</h4>
@if (Model.Propuestas != null && Model.Propuestas.Any())
{
    <table class="table table-sm">
        <thead>
            <tr><th>Equipo</th><th>Estado</th><th>Fecha</th></tr>
        </thead>
        <tbody>
        @foreach (var p in Model.Propuestas)
        {
            <tr>
                <td>@(p.EquipoProponente?.Nombre ?? "-" )</td>
                <td>@p.Estado</td>
                <td>@(p.FechaPropuesta == default ? "-" : p.FechaPropuesta.ToString("yyyy-MM-dd"))</td>
            </tr>
        }
        </tbody>
    </table>
}
else
{
    <p>No hay propuestas para este torneo.</p>
}

<h4>Participaciones</h4>
@if (Model.Participaciones != null && Model.Participaciones.Any())
{
    <table class="table table-sm">
        <thead>
            <tr><th>Equipo</th><th>Estado</th><th>Fecha alta</th></tr>
        </thead>
        <tbody>
        @foreach (var pt in Model.Participaciones)
        {
            <tr>
                <td>@(pt.Equipo?.Nombre ?? "-")</td>
                <td>@pt.Estado</td>
                <td>@(pt.FechaAlta == default ? "-" : pt.FechaAlta.ToString("yyyy-MM-dd"))</td>
            </tr>
        }
        </tbody>
    </table>
}
else
{
    <p>No hay participaciones confirmadas aún.</p>
}
